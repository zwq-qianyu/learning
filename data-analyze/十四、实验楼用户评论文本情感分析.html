
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <!-- common.css -->
      <style>* {-webkit-tap-highlight-color: rgba(0,0,0,0);}html {-webkit-text-size-adjust: none;}body {font-family: -apple-system, Helvetica, Arial, sans-serif;margin: 0;padding: 20px;color: #333;word-wrap: break-word;}h1, h2, h3, h4, h5, h6 {line-height: 1.1;}img {max-width: 100% !important;height: auto;}blockquote {margin: 0;padding: 0 15px;color: #777;border-left: 4px solid #ddd;}hr {background-color: #ddd;border: 0;height: 1px;margin: 15px 0;}code {font-family: Menlo, Consolas, 'Ubuntu Mono', Monaco, 'source-code-pro', monospace;line-height: 1.4;margin: 0;padding: 0.2em 0;font-size: 90%;background-color: rgba(0,0,0,0.04);border-radius: 3px;}pre > code {margin: 0;padding: 0;font-size: 100%;word-break: normal;background: transparent;border: 0;}ol {list-style-type: decimal;}ol ol, ul ol {list-style-type: lower-latin;}ol ol ol, ul ol ol, ul ul ol, ol ul ol {list-style-type: lower-roman;}table {border-spacing: 0;border-collapse: collapse;margin-top: 0;margin-bottom: 16px;}table th {font-weight: bold;}table th, table td {padding: 6px 13px;border: 1px solid #ddd;}table tr {border-top: 1px solid #ccc;}table tr:nth-child(even) {background-color: #f8f8f8;}input[type="checkbox"] {cursor: default;margin-right: 0.5em;font-size: 13px;}.task-list-item {list-style-type: none;}.task-list-item+.task-list-item {margin-top: 3px;}.task-list-item input {float: left;margin: 0.3em 1em 0.25em -1.6em;vertical-align: middle;}#tag-field {margin: 8px 2px 10px;}#tag-field .tag {display: inline-block;background: #cadff3;border-radius: 4px;padding: 1px 8px;color: black;font-size: 12px;margin-right: 10px;line-height: 1.4;}</style>
      <!-- ace-static.css -->
      <style>.ace_static_highlight {white-space: pre-wrap;}.ace_static_highlight .ace_gutter {width: 2em;text-align: right;padding: 0 3px 0 0;margin-right: 3px;}.ace_static_highlight.ace_show_gutter > .ace_line {padding-left: 2.6em;}.ace_static_highlight .ace_line {position: relative;}.ace_static_highlight .ace_gutter-cell {-moz-user-select: -moz-none;-khtml-user-select: none;-webkit-user-select: none;user-select: none;top: 0;bottom: 0;left: 0;position: absolute;}.ace_static_highlight .ace_gutter-cell:before {content: counter(ace_line, decimal);counter-increment: ace_line;}.ace_static_highlight {counter-reset: ace_line;}</style>
      <style>.ace-chrome .ace_gutter {background: #ebebeb;color: #333;overflow : hidden;}.ace-chrome .ace_print-margin {width: 1px;background: #e8e8e8;}.ace-chrome {background-color: #FFFFFF;color: black;}.ace-chrome .ace_cursor {color: black;}.ace-chrome .ace_invisible {color: rgb(191, 191, 191);}.ace-chrome .ace_constant.ace_buildin {color: rgb(88, 72, 246);}.ace-chrome .ace_constant.ace_language {color: rgb(88, 92, 246);}.ace-chrome .ace_constant.ace_library {color: rgb(6, 150, 14);}.ace-chrome .ace_invalid {background-color: rgb(153, 0, 0);color: white;}.ace-chrome .ace_fold {}.ace-chrome .ace_support.ace_function {color: rgb(60, 76, 114);}.ace-chrome .ace_support.ace_constant {color: rgb(6, 150, 14);}.ace-chrome .ace_support.ace_type,.ace-chrome .ace_support.ace_class.ace-chrome .ace_support.ace_other {color: rgb(109, 121, 222);}.ace-chrome .ace_variable.ace_parameter {font-style:italic;color:#FD971F;}.ace-chrome .ace_keyword.ace_operator {color: rgb(104, 118, 135);}.ace-chrome .ace_comment {color: #236e24;}.ace-chrome .ace_comment.ace_doc {color: #236e24;}.ace-chrome .ace_comment.ace_doc.ace_tag {color: #236e24;}.ace-chrome .ace_constant.ace_numeric {color: rgb(0, 0, 205);}.ace-chrome .ace_variable {color: rgb(49, 132, 149);}.ace-chrome .ace_xml-pe {color: rgb(104, 104, 91);}.ace-chrome .ace_entity.ace_name.ace_function {color: #0000A2;}.ace-chrome .ace_heading {color: rgb(12, 7, 255);}.ace-chrome .ace_list {color:rgb(185, 6, 144);}.ace-chrome .ace_marker-layer .ace_selection {background: rgb(181, 213, 255);}.ace-chrome .ace_marker-layer .ace_step {background: rgb(252, 255, 0);}.ace-chrome .ace_marker-layer .ace_stack {background: rgb(164, 229, 101);}.ace-chrome .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgb(192, 192, 192);}.ace-chrome .ace_marker-layer .ace_active-line {background: rgba(0, 0, 0, 0.07);}.ace-chrome .ace_gutter-active-line {background-color : #dcdcdc;}.ace-chrome .ace_marker-layer .ace_selected-word {background: rgb(250, 250, 255);border: 1px solid rgb(200, 200, 250);}.ace-chrome .ace_storage,.ace-chrome .ace_keyword,.ace-chrome .ace_meta.ace_tag {color: rgb(147, 15, 128);}.ace-chrome .ace_string.ace_regex {color: rgb(255, 0, 0)}.ace-chrome .ace_string {color: #1A1AA6;}.ace-chrome .ace_entity.ace_other.ace_attribute-name {color: #994409;}.ace-chrome .ace_indent-guide {background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;}</style>
      <!-- export.css -->
      <style>
        body{margin:0 auto;max-width:800px;line-height:1.4}
        #nav{margin:5px 0 10px;font-size:15px}
        #titlearea{border-bottom:1px solid #ccc;font-size:17px;padding:10px 0;}
        #contentarea{font-size:15px;margin:16px 0}
        .cell{outline:0;min-height:20px;margin:5px 0;padding:5px 0;}
        .code-cell{font-family:Menlo,Consolas,'Ubuntu Mono',Monaco,'source-code-pro',monospace;font-size:12px;}
        .latex-cell{white-space:pre-wrap;}
      </style>
      <!-- User CSS -->
      <style> .text-cell {font-size: 15px;}.code-cell {font-size: 12px;}.markdown-cell {font-size: 15px;}.latex-cell {font-size: 15px;}</style>
    </head>
    <body>
      <div id="nav"><div>Next: <a href='十三、实验楼课程数据分析.html'>十三、实验楼课程数据分析</a>, Previous: <a href='十五、实验楼用户购买会员行为预测.html'>十五、实验楼用户购买会员行为预测</a>, Up: <a href='index.html'>Index</a></div></div>
      <div id="titlearea">
        <h2>十四、实验楼用户评论文本情感分析</h2>
      </div>
      <div id="contentarea"><div class="cell text-cell"><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">本实验为实验楼训练营课程 《Python 数据分析入门与进阶》的第九节，在该章节中我们将对实验楼用户产生的真实评论数据进行情感分析。</p><h2 id="-" style="box-sizing: border-box; font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; line-height: 1.25; color: rgb(36, 41, 46); margin-top: 24px; margin-bottom: 16px; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(234, 236, 239); font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">什么是情感分析？</h2><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">本文所涉及到情感分析，又称为文本情感分析，这是自然语言处理和文本挖掘过程中涉及到的一块内容。</p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">简而言之，我们通过算法去判断一段文本、评论的情感偏向，从而快速地了解表达这段文本的原作者的主观情绪。</p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">现实中，当我们在陈述一段内容时，可能会出现的情绪有：高兴、兴奋、激动、没感觉、失落、压抑、紧张、疑惑等。而在自然语言处理的世界里，我们尚且达不到如此细小的分类。所以，往往在针对文本进行情感分析时，只处理两种情绪状态：积极和消极。</p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">当然，上面提到的计算机无法处理更细分的情绪类别其实并不准确。因为，算法原则上是能够区分更多的情绪类别，关键在于我们需要提供一个人工标注过的复杂情绪训练集，而这是非常难做到的。所以，目前我们在进行情感分析时，只处理积极和消极两种状态。</p><h2 id="-" style="box-sizing: border-box; font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; line-height: 1.25; color: rgb(36, 41, 46); margin-top: 24px; margin-bottom: 16px; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(234, 236, 239); font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">基于词典的文本情感分析</h2><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">目前，针对文本情感分析的方法有两种，一种基于词典，另一种基于机器学习方法。首先，我们来叙述一下基于词典的文本情感分析原理。</p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">基于词典的情感分析是非常简单和易于理解的一种方法。概括来讲，我们首先有一个人工标注好的词典。词典中的每一个此都对应这消极或积极的标签。词典举例如下：</p><table style="box-sizing: border-box; background-color: rgb(249, 249, 249); display: block; width: 344px; overflow: auto; word-break: keep-all; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2;"><thead style="box-sizing: border-box;"><tr style="box-sizing: border-box; background-color: rgb(255, 255, 255); border-top-color: rgb(198, 203, 209);"><th style="box-sizing: border-box; border-color: rgb(223, 226, 229);">词语</th><th style="box-sizing: border-box; border-color: rgb(223, 226, 229);">标签</th></tr></thead><tbody style="box-sizing: border-box;"><tr style="box-sizing: border-box; background-color: rgb(255, 255, 255); border-top-color: rgb(198, 203, 209);"><td style="box-sizing: border-box; border-color: rgb(223, 226, 229);">很好</td><td style="box-sizing: border-box; border-color: rgb(223, 226, 229);">积极</td></tr><tr style="box-sizing: border-box; background-color: rgb(246, 248, 250); border-top-color: rgb(198, 203, 209);"><td style="box-sizing: border-box; border-color: rgb(223, 226, 229);">不好</td><td style="box-sizing: border-box; border-color: rgb(223, 226, 229);">消极</td></tr><tr style="box-sizing: border-box; background-color: rgb(255, 255, 255); border-top-color: rgb(198, 203, 209);"><td style="box-sizing: border-box; border-color: rgb(223, 226, 229);">高兴</td><td style="box-sizing: border-box; border-color: rgb(223, 226, 229);">积极</td></tr><tr style="box-sizing: border-box; background-color: rgb(246, 248, 250); border-top-color: rgb(198, 203, 209);"><td style="box-sizing: border-box; border-color: rgb(223, 226, 229);">难受</td><td style="box-sizing: border-box; border-color: rgb(223, 226, 229);">消极</td></tr><tr style="box-sizing: border-box; background-color: rgb(255, 255, 255); border-top-color: rgb(198, 203, 209);"><td style="box-sizing: border-box; border-color: rgb(223, 226, 229);">爱你</td><td style="box-sizing: border-box; border-color: rgb(223, 226, 229);">积极</td></tr><tr style="box-sizing: border-box; background-color: rgb(246, 248, 250); border-top-color: rgb(198, 203, 209);"><td style="box-sizing: border-box; border-color: rgb(223, 226, 229);">讨厌</td><td style="box-sizing: border-box; border-color: rgb(223, 226, 229);">消极</td></tr><tr style="box-sizing: border-box; background-color: rgb(255, 255, 255); border-top-color: rgb(198, 203, 209);"><td style="box-sizing: border-box; border-color: rgb(223, 226, 229);">……</td><td style="box-sizing: border-box; border-color: rgb(223, 226, 229);">……</td></tr></tbody></table><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">然后，这个词典可能有上万条或者几十万条，当然是越多越好。有了词典之后，我们就可以开始进行文本情感分析了。</p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">现在，我们收到一条用户评论：</p><blockquote style="box-sizing: border-box; padding-right: 1em; padding-left: 1em; margin-bottom: 16px; font-size: 17.5px; border-left-width: 0.25em; border-left-color: rgb(223, 226, 229); color: rgb(106, 115, 125); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);"><p style="box-sizing: border-box; margin: 0px;">这门课程很好啊！</p></blockquote><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">然后，我们可以对这句话进行分词。分词结果如下：</p><blockquote style="box-sizing: border-box; padding-right: 1em; padding-left: 1em; margin-bottom: 16px; font-size: 17.5px; border-left-width: 0.25em; border-left-color: rgb(223, 226, 229); color: rgb(106, 115, 125); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);"><p style="box-sizing: border-box; margin: 0px;">['这门', '课程', '很', '好', '啊', '！']</p></blockquote><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">接下来，我们拿分好的词依次去匹配词典。匹配的方法很简单:</p><ol style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; padding-left: 2em; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);"><li style="box-sizing: border-box;">如果词典中存在该词且为积极标签，那么我们记&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">+1</code>;</li><li style="box-sizing: border-box; margin-top: 0.25em;">如果词典中存在该词且为消极标签，那么我们记&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">-1</code>;</li><li style="box-sizing: border-box; margin-top: 0.25em;">如果词典中不存在该词，我们记&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">0</code>。</li></ol><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">匹配完一个句子之后，我们就可以计算整个句子的得分。总得分&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">&gt;0</code>&nbsp;表示该句子情绪为积极，总得分小于零代表该句子为消极，总得分&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">= 0</code>&nbsp;表示无法判断情绪。</p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">通过词典进行情绪分析的方法很简单，但缺点也很明显。我们往往需要一个很大的词典，且不断更新。这对人力物力都是极大的考验。</p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">除此之外，该方法还有无法通过扩充词典解决的情绪判断问题。例如，当我们人类在判断一句话的清晰时，我们会往往更偏向于从整体把握（语言环境），尤其是在乎一些语气助词对情绪的影响。而基于词典进行情绪分析的方法就做不到这一点，将句子拆成词，就会影响句子的整体情绪表达。</p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">目前，针对中文做情感标注的词典少之又少。比较常用的有：</p><ol style="box-sizing: border-box; margin-top: 0px; margin-bottom: 16px; padding-left: 2em; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);"><li style="box-sizing: border-box;">台湾大学&nbsp;<a href="http://academiasinicanlplab.github.io/" target="_blank" style="box-sizing: border-box; background-color: transparent; color: rgb(3, 102, 214); text-decoration: none;">NTUSD 情感词典</a>.</li><li style="box-sizing: border-box; margin-top: 0.25em;">《知网》情感分析用<a href="http://www.keenage.com/html/c_bulletin_2007.htm" target="_blank" style="box-sizing: border-box; background-color: transparent; color: rgb(3, 102, 214); text-decoration: none;">词语集（beta版）</a></li></ol><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">以《知网》情感词典举例，它包含有 5 个文件，分别列述了正面与负面的情感词语以及程度词汇。</p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);"><img src="resources/F22183E0E8A8C27F4B4FFCDED17ABB7D.png" alt="此处输入图片的描述" style="box-sizing: content-box; border: 0px none; vertical-align: middle; background-color: rgb(255, 255, 255); cursor: pointer;" width="480" height="123"></p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">由于上面介绍的这种简单的词典对比方法准确率并不高，所以本实验不会通过这种方法来实现用户评论情绪分析。</p><h2 id="-word2vec-" style="box-sizing: border-box; font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; line-height: 1.25; color: rgb(36, 41, 46); margin-top: 24px; margin-bottom: 16px; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(234, 236, 239); font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">基于词袋或 Word2vec 的文本情感分析</h2><h3 id="-" style="box-sizing: border-box; font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; line-height: 1.25; color: rgb(36, 41, 46); margin-top: 24px; margin-bottom: 16px; font-size: 1.25em; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">「词袋」模型</h3><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">除了基于词典对评论进行情感分析，我们还有一种方法称之为「词袋」模型。「词袋」不再将一句话看做是单个词汇构成，而是当作一个 1xN 的向量。举个例子，我们现在有两句话需要处理，分别是：</p><blockquote style="box-sizing: border-box; padding-right: 1em; padding-left: 1em; margin-bottom: 16px; font-size: 17.5px; border-left-width: 0.25em; border-left-color: rgb(223, 226, 229); color: rgb(106, 115, 125); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);"><p style="box-sizing: border-box; margin: 0px;">我爱你，我非常爱你。 我喜欢你，我非常喜欢你。</p></blockquote><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">我们针对这两句话进行分词之后，去重处理为一个「词袋」：</p><blockquote style="box-sizing: border-box; padding-right: 1em; padding-left: 1em; margin-bottom: 16px; font-size: 17.5px; border-left-width: 0.25em; border-left-color: rgb(223, 226, 229); color: rgb(106, 115, 125); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);"><p style="box-sizing: border-box; margin: 0px;">['我', '爱', '喜欢', '你', '非常']</p></blockquote><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">然后，根据「词袋」，我们对原句子进行向量转换。其中，向量的长度 N 为「词袋」的长度，而向量中每一个数值依次为「词袋」中的词出现在该句子中的次数。</p><blockquote style="box-sizing: border-box; padding-right: 1em; padding-left: 1em; margin-bottom: 16px; font-size: 17.5px; border-left-width: 0.25em; border-left-color: rgb(223, 226, 229); color: rgb(106, 115, 125); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);"><p style="box-sizing: border-box; margin: 0px;">我爱你，我非常爱你。 -&gt; [2, 2, 0, 2, 1] 我喜欢你，我非常喜欢你。 -&gt; [2, 0, 2, 2, 1]</p></blockquote><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">有了「词袋」，有了已经人工标注好的句子，就组成了我们的训练数据。再根据机器学习方法来构建分类预测模型。从而判断新输入句子的情感。</p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">你会发现，「词袋」模型和我们之前提到的 One-Hot 独热编码非常相似。其实这里就是将之前独热编码里的词变成了句子而已。</p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">「词袋」模型固然比简单的词典对比方法更好，但 One-Hot 无法度量上下文之间的距离，也就无法结合上下文进行情感判断。下面，我们介绍一种词向量的 Word2vec 处理方法，就会很好地克服这个缺点。</p><h3 id="word2vec" style="box-sizing: border-box; font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; line-height: 1.25; color: rgb(36, 41, 46); margin-top: 24px; margin-bottom: 16px; font-size: 1.25em; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">Word2vec</h3><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">Word2vec</code>，故名思意就是将句子转换为向量，也就是词向量。Word2vec 最早由 Google 在 2013 年开源，它是由浅层神经网络组成的词向量转换模型。</p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">Word2vec</code>&nbsp;的输入一般为规模庞大的语料库，输出为向量空间。Word2vec 的特点在于，语料库中的每个词都对应了向量空间中的一个向量，拥有上下文关系的词，映射到向量空间中的距离会更加接近。</p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">Word2vec</code>&nbsp;的主要结构是&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">CBOW（Continuous Bag-of-Words Model）</code>模型和&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">Skip-gram（Continuous Skip-gram）</code>模型结合在一起。简单来讲，二者都是想通过上下文得到一个词出现的概率。</p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">CBOW</code>模型通过一个词的上下文（各<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">N</code>个词）预测当前词。而&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">Skip-gram</code>&nbsp;则恰好相反，他是用一个词预测其上下文，得到了当前词上下文的很多样本，因此可用于更大的数据集。</p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">CBOW （N=2</code>）和&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">Skip-gram</code>的结构如下图所示：</p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);"><img src="resources/CB20848955B12042F40E675662C093A4.jpg" alt="此处输入图片的描述" style="box-sizing: content-box; border: 0px none; vertical-align: middle; background-color: rgb(255, 255, 255); cursor: pointer;" width="2144" height="1360"></p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">图中&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">w(t)</code>&nbsp;表示当前的词汇，而&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">w(t−n)，w(t+n)</code>&nbsp;等则用来表示上下文词汇。</p><h2 id="-" style="box-sizing: border-box; font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; line-height: 1.25; color: rgb(36, 41, 46); margin-top: 24px; margin-bottom: 16px; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(234, 236, 239); font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">实验楼用户评论情感分析</h2><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">为了保证良好的准确度，本次实验我们选用了&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">Word2vec</code>结合<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">SVM</code>&nbsp;支持向量机的文本情感分析方法。首先，我们需要使用&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">Word2vec</code>&nbsp;来建立向量空间，之后再使用&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">SVM</code>支持向量机训练文本情感分类模型。</p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">由于我们未人工针对实验楼评论进行语料库标注，所以这里需要选择其他的已标注语料库进行模型训练。</p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">这里，我们选用了网友&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">@苏剑林</code>提供的语料库。该语料库整合了书籍、计算机等&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">7</code>个领域的评论数据。</p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">你可以通过下面链接下载本次实验所需要的数据集：</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; padding: 9.5px; margin-top: 0px; margin-bottom: 10px; line-height: 1.42857; word-break: break-all; overflow-wrap: break-word; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; font-variant-ligatures: normal; orphans: 2; widows: 2;"><code class="hljs " style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: inherit; padding: 0.5em; color: rgb(248, 248, 242); background-color: rgb(35, 36, 31); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; white-space: pre-wrap; word-break: break-all; display: block; overflow-x: auto;">wget http:<span class="hljs-comment" style="box-sizing: border-box; color: rgb(117, 113, 94);">//labfile.oss.aliyuncs.com/courses/764/data_09.zip</span>

<span class="hljs-meta" style="box-sizing: border-box; color: rgb(117, 113, 94);"># 解压</span>
unzip data_09.zip
.
├── course_09<span class="hljs-meta-keyword" style="box-sizing: border-box;">/data/</span>neg.xls <span class="hljs-meta" style="box-sizing: border-box; color: rgb(117, 113, 94);"># 消极（负面）语句语料库</span>
├── course_09<span class="hljs-meta-keyword" style="box-sizing: border-box;">/data/</span>pos.xls <span class="hljs-meta" style="box-sizing: border-box; color: rgb(117, 113, 94);"># 积极（正面）语句语料库</span>
└── course_09/comments.csv <span class="hljs-meta" style="box-sizing: border-box; color: rgb(117, 113, 94);"># 实验楼用户评论数据</span>
</code></pre><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">三个数据文件的预览如下。</p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">其中，<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">neg.xls</code>&nbsp;共有&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">10428</code>&nbsp;行。</p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);"><img src="resources/CD84D0CB38B839CAA313C484EDE801F3.png" alt="此处输入图片的描述" style="box-sizing: content-box; border: 0px none; vertical-align: middle; background-color: rgb(255, 255, 255); cursor: pointer;" width="839" height="135"></p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">pos.xls</code>共有&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">10679</code>&nbsp;行。</p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);"><img src="resources/D42A53B9474E6D59330269A3CDFCE1F1.png" alt="此处输入图片的描述" style="box-sizing: content-box; border: 0px none; vertical-align: middle; background-color: rgb(255, 255, 255); cursor: pointer;" width="709" height="147"></p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">comments.csv</code>&nbsp;共有&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">12377</code>&nbsp;行。</p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);"><img src="resources/DED488B2C2524AF2EF102972687A7E93.png" alt="此处输入图片的描述" style="box-sizing: content-box; border: 0px none; vertical-align: middle; background-color: rgb(255, 255, 255); cursor: pointer;" width="519" height="143"></p><h3 id="-" style="box-sizing: border-box; font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; line-height: 1.25; color: rgb(36, 41, 46); margin-top: 24px; margin-bottom: 16px; font-size: 1.25em; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">语料库分词处理</h3><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">在使用 Word2vec 之前，我们需要先对训练语料库进行分词处理。这里依旧使用上一节课提到的 jieba 分词。安装&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">jieba</code>：</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; padding: 9.5px; margin-top: 0px; margin-bottom: 10px; line-height: 1.42857; word-break: break-all; overflow-wrap: break-word; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; font-variant-ligatures: normal; orphans: 2; widows: 2;"><code class="hljs python" style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: inherit; padding: 0.5em; color: rgb(248, 248, 242); background-color: rgb(35, 36, 31); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; white-space: pre-wrap; word-break: break-all; display: block; overflow-x: auto;"><span class="hljs-meta" style="box-sizing: border-box; color: rgb(117, 113, 94);">#</span><span class="bash" style="box-sizing: border-box;"> 安装包到 anaconda3</span>
<span class="hljs-meta" style="box-sizing: border-box; color: rgb(117, 113, 94);">$</span><span class="bash" style="box-sizing: border-box;"> sudo anaconda3/bin/pip install jieba</span>
</code></pre><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">然后，在&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">data_09</code>&nbsp;文件夹下建立&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">words_array.py</code>&nbsp;文件：</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; padding: 9.5px; margin-top: 0px; margin-bottom: 10px; line-height: 1.42857; word-break: break-all; overflow-wrap: break-word; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; font-variant-ligatures: normal; orphans: 2; widows: 2;"><code class="hljs " style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: inherit; padding: 0.5em; color: rgb(248, 248, 242); background-color: rgb(35, 36, 31); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; white-space: pre-wrap; word-break: break-all; display: block; overflow-x: auto;"><span class="hljs-comment" style="box-sizing: border-box; color: rgb(117, 113, 94);"># -*- coding: utf-8 -*-</span>

<span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">import</span> pandas <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">as</span> pd
<span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">import</span> jieba
<span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">import</span> numpy <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">as</span> np

<span class="hljs-comment" style="box-sizing: border-box; color: rgb(117, 113, 94);"># 加载语料库文件，并导入数据</span>
neg = pd.read_excel(<span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);">'data/neg.xls'</span>, header=<span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">None</span>, index=<span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">None</span>)
pos = pd.read_excel(<span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);">'data/pos.xls'</span>, header=<span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">None</span>, index=<span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">None</span>)

<span class="hljs-comment" style="box-sizing: border-box; color: rgb(117, 113, 94);"># jieba 分词</span>
word_cut = <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">lambda</span> x: jieba.lcut(x)
pos[<span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);">'words'</span>] = pos[<span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);">0</span>].apply(word_cut)
neg[<span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);">'words'</span>] = neg[<span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);">0</span>].apply(word_cut)

<span class="hljs-comment" style="box-sizing: border-box; color: rgb(117, 113, 94);"># 使用 1 表示积极情绪，0 表示消极情绪，并完成数组拼接</span>
x = np.concatenate((pos[<span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);">'words'</span>], neg[<span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);">'words'</span>]))
y = np.concatenate((np.ones(len(pos)), np.zeros(len(neg))))

<span class="hljs-comment" style="box-sizing: border-box; color: rgb(117, 113, 94);"># 将 Ndarray 保存为二进制文件备用</span>
np.save(<span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);">'data/x_train.npy'</span>, x)
np.save(<span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);">'data/y_train.npy'</span>, y)

print(<span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);">'done.'</span>)
</code></pre><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">你可以预览一下数组的形状，以 x 为例：</p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);"><img src="resources/EAF7EF05A1BC539C970104ABE00264D9.png" alt="此处输入图片的描述" style="box-sizing: content-box; border: 0px none; vertical-align: middle; background-color: rgb(255, 255, 255); cursor: pointer;" width="579" height="103"></p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">执行&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">words_array.py</code>，在线环境运行可能需要稍等几分钟。<span style="box-sizing: border-box; font-weight: 600;">特别注意，我们的实验均是在 anaconda 的 python 3.6.1 下执行，务必注意每次安装包和执行代码是调用的 python 路径。</span></p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; padding: 9.5px; margin-top: 0px; margin-bottom: 10px; line-height: 1.42857; word-break: break-all; overflow-wrap: break-word; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; font-variant-ligatures: normal; orphans: 2; widows: 2;"><code class="hljs bash" style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: inherit; padding: 0.5em; color: rgb(248, 248, 242); background-color: rgb(35, 36, 31); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; white-space: pre-wrap; word-break: break-all; display: block; overflow-x: auto;">$ <span class="hljs-regexp" style="box-sizing: border-box; color: rgb(174, 129, 255);">/home/</span>shiyanlou<span class="hljs-regexp" style="box-sizing: border-box; color: rgb(174, 129, 255);">/anaconda3/</span>bin<span class="hljs-regexp" style="box-sizing: border-box; color: rgb(174, 129, 255);">/python words_array.py</span>
</code></pre><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);"><img src="resources/16C7D59A23ED6A4BD34C53FFC6F7037A.jpg" alt="此处输入图片的描述" style="box-sizing: content-box; border: 0px none; vertical-align: middle; background-color: rgb(255, 255, 255); cursor: pointer;" width="562" height="99"></p><h3 id="word2vec-" style="box-sizing: border-box; font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; line-height: 1.25; color: rgb(36, 41, 46); margin-top: 24px; margin-bottom: 16px; font-size: 1.25em; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 18px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">Word2vec</code>处理</h3><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">有了分词之后的数组，我们就可以开始 Word2vec 处理，将其转换为词向量了。目前，很多开源工具都提供了 Word2vec 方法，比如&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">gensim，tensorflow，PaddlePaddle</code>&nbsp;等。这里我们使用&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">gensim</code>。你需要先安装 gensim，可能会需要几分钟时间。如果没有&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">gensim</code>&nbsp;安装成功，请关闭终端重试。</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; padding: 9.5px; margin-top: 0px; margin-bottom: 10px; line-height: 1.42857; word-break: break-all; overflow-wrap: break-word; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; font-variant-ligatures: normal; orphans: 2; widows: 2;"><code class="hljs bash" style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: inherit; padding: 0.5em; color: rgb(248, 248, 242); background-color: rgb(35, 36, 31); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; white-space: pre-wrap; word-break: break-all; display: block; overflow-x: auto;"><span class="hljs-meta" style="box-sizing: border-box; color: rgb(117, 113, 94);">#</span><span class="bash" style="box-sizing: border-box;"> 安装包到 anaconda3</span>
<span class="hljs-meta" style="box-sizing: border-box; color: rgb(117, 113, 94);">$</span><span class="bash" style="box-sizing: border-box;"> sudo anaconda3/bin/pip install gensim</span>
</code></pre><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">然后我们编写<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">word2vec.py</code>代码</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; padding: 9.5px; margin-top: 0px; margin-bottom: 10px; line-height: 1.42857; word-break: break-all; overflow-wrap: break-word; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; font-variant-ligatures: normal; orphans: 2; widows: 2;"><code class="hljs python" style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: inherit; padding: 0.5em; color: rgb(248, 248, 242); background-color: rgb(35, 36, 31); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; white-space: pre-wrap; word-break: break-all; display: block; overflow-x: auto;"><span class="hljs-comment" style="box-sizing: border-box; color: rgb(117, 113, 94);"># -*- coding: utf-8 -*-</span>

<span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">import</span> numpy <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">as</span> np
<span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">from</span> gensim.models.word2vec <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">import</span> Word2Vec

<span class="hljs-comment" style="box-sizing: border-box; color: rgb(117, 113, 94);"># 导入上面保存的分词数组</span>
x_train = np.load(<span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);">'data/x_train.npy'</span>)

<span class="hljs-comment" style="box-sizing: border-box; color: rgb(117, 113, 94);"># 训练 Word2Vec 浅层神经网络模型</span>
w2v = Word2Vec(size=<span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);">300</span>, min_count=<span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);">10</span>)
w2v.build_vocab(x_train)
w2v.train(x_train, total_examples=w2v.corpus_count, epochs=w2v.iter)

<span class="hljs-comment" style="box-sizing: border-box; color: rgb(117, 113, 94);"># 对每个句子的词向量进行均值计算</span>
<span class="hljs-function" style="box-sizing: border-box;"><span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">def</span> <span class="hljs-title" style="box-sizing: border-box; color: rgb(166, 226, 46);">average_vec</span><span class="hljs-params" style="box-sizing: border-box;">(text)</span>:</span>
    vec = np.zeros(<span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);">300</span>).reshape((<span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);">1</span>, <span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);">300</span>))
    <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">for</span> word <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">in</span> text:
        <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">try</span>:
            vec += w2v[word].reshape((<span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);">1</span>, <span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);">300</span>))
        <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">except</span> KeyError:
            <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">continue</span>
    <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">return</span> vec

<span class="hljs-comment" style="box-sizing: border-box; color: rgb(117, 113, 94);"># 将词向量保存为 Ndarray</span>
train_vec = np.concatenate([average_vec(z) <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">for</span> z <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">in</span> x_train])

<span class="hljs-comment" style="box-sizing: border-box; color: rgb(117, 113, 94);"># 保存 Word2Vec 模型及词向量</span>
w2v.save(<span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);">'data/w2v_model.pkl'</span>)
np.save(<span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);">'data/x_train_vec.npy'</span>, train_vec)
</code></pre><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">执行&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">word2vec.py</code>，这个过程可能需要几分钟。</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; padding: 9.5px; margin-top: 0px; margin-bottom: 10px; line-height: 1.42857; word-break: break-all; overflow-wrap: break-word; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; font-variant-ligatures: normal; orphans: 2; widows: 2;"><code class="hljs bash" style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: inherit; padding: 0.5em; color: rgb(248, 248, 242); background-color: rgb(35, 36, 31); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; white-space: pre-wrap; word-break: break-all; display: block; overflow-x: auto;">$ <span class="hljs-regexp" style="box-sizing: border-box; color: rgb(174, 129, 255);">/home/</span>shiyanlou<span class="hljs-regexp" style="box-sizing: border-box; color: rgb(174, 129, 255);">/anaconda3/</span>bin<span class="hljs-regexp" style="box-sizing: border-box; color: rgb(174, 129, 255);">/python word2vec.py</span>
</code></pre><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">执行结束之后，你会得到我们保存的两个新的二进制文件。</p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);"><img src="resources/654FF303129EDD879F2948BA656B98F1.png" alt="此处输入图片的描述" style="box-sizing: content-box; border: 0px none; vertical-align: middle; background-color: rgb(255, 255, 255); cursor: pointer;" width="438" height="232"></p><h3 id="-" style="box-sizing: border-box; font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; line-height: 1.25; color: rgb(36, 41, 46); margin-top: 24px; margin-bottom: 16px; font-size: 1.25em; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">训练支持向量机情绪分类模型</h3><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">有了词向量，我们就有了机器学习模型的输入。那么，我们就可以训练支持向量机情绪分类模型。这一块内容你应该很熟悉，使用 scikit-learn 完成。新建一个&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">svm_fit.py</code>文件。</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; padding: 9.5px; margin-top: 0px; margin-bottom: 10px; line-height: 1.42857; word-break: break-all; overflow-wrap: break-word; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; font-variant-ligatures: normal; orphans: 2; widows: 2;"><code class="hljs " style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: inherit; padding: 0.5em; color: rgb(248, 248, 242); background-color: rgb(35, 36, 31); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; white-space: pre-wrap; word-break: break-all; display: block; overflow-x: auto;"><span class="hljs-meta" style="box-sizing: border-box; color: rgb(117, 113, 94);"># -*- coding: utf-8 -*-</span>

<span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">import</span> numpy <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">as</span> np
<span class="hljs-title" style="box-sizing: border-box; color: rgb(166, 226, 46);">from</span> sklearn.externals <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">import</span> joblib
<span class="hljs-title" style="box-sizing: border-box; color: rgb(166, 226, 46);">from</span> sklearn.svm <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">import</span> SVC

<span class="hljs-meta" style="box-sizing: border-box; color: rgb(117, 113, 94);"># 导入词向量为训练特征</span>
<span class="hljs-title" style="box-sizing: border-box; color: rgb(166, 226, 46);">x</span> = np.load('<span class="hljs-class" style="box-sizing: border-box;"><span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">data</span>/x_train_vec.npy')</span>

<span class="hljs-meta" style="box-sizing: border-box; color: rgb(117, 113, 94);"># 导入情绪分类作为目标特征</span>
<span class="hljs-title" style="box-sizing: border-box; color: rgb(166, 226, 46);">y</span> = np.load('<span class="hljs-class" style="box-sizing: border-box;"><span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">data</span>/y_train.npy')</span>

<span class="hljs-meta" style="box-sizing: border-box; color: rgb(117, 113, 94);"># 构建支持向量机分类模型</span>
<span class="hljs-title" style="box-sizing: border-box; color: rgb(166, 226, 46);">model</span> = <span class="hljs-type" style="box-sizing: border-box; color: rgb(230, 219, 116);">SVC</span>(kernel='rbf', verbose=<span class="hljs-type" style="box-sizing: border-box; color: rgb(230, 219, 116);">True</span>)

<span class="hljs-meta" style="box-sizing: border-box; color: rgb(117, 113, 94);"># 训练模型</span>
<span class="hljs-title" style="box-sizing: border-box; color: rgb(166, 226, 46);">model</span>.fit(x, y)

<span class="hljs-meta" style="box-sizing: border-box; color: rgb(117, 113, 94);"># 保存模型为二进制文件</span>
<span class="hljs-title" style="box-sizing: border-box; color: rgb(166, 226, 46);">joblib</span>.dump(model, '<span class="hljs-class" style="box-sizing: border-box;"><span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">data</span>/svm_model.pkl')</span>
</code></pre><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">执行&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">svm_fit.py</code>，由于在线虚拟环境的计算能力较弱，训练过程可能需要** 20 多分钟**。</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; padding: 9.5px; margin-top: 0px; margin-bottom: 10px; line-height: 1.42857; word-break: break-all; overflow-wrap: break-word; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; font-variant-ligatures: normal; orphans: 2; widows: 2;"><code class="hljs bash" style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: inherit; padding: 0.5em; color: rgb(248, 248, 242); background-color: rgb(35, 36, 31); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; white-space: pre-wrap; word-break: break-all; display: block; overflow-x: auto;">$ <span class="hljs-regexp" style="box-sizing: border-box; color: rgb(174, 129, 255);">/home/</span>shiyanlou<span class="hljs-regexp" style="box-sizing: border-box; color: rgb(174, 129, 255);">/anaconda3/</span>bin<span class="hljs-regexp" style="box-sizing: border-box; color: rgb(174, 129, 255);">/python svm_fit.py</span>
</code></pre><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">如果有条件，推荐在本地完成训练。或者直接通过下面的链接下载模型用于后面的内容。</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; padding: 9.5px; margin-top: 0px; margin-bottom: 10px; line-height: 1.42857; word-break: break-all; overflow-wrap: break-word; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; font-variant-ligatures: normal; orphans: 2; widows: 2;"><code class="hljs " style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: inherit; padding: 0.5em; color: rgb(248, 248, 242); background-color: rgb(35, 36, 31); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; white-space: pre-wrap; word-break: break-all; display: block; overflow-x: auto;"><span class="hljs-comment" style="box-sizing: border-box; color: rgb(117, 113, 94);"># 支持向量机预训练模型</span>
wget http:<span class="hljs-regexp" style="box-sizing: border-box; color: rgb(174, 129, 255);">//</span>labfile.oss.aliyuncs.com<span class="hljs-regexp" style="box-sizing: border-box; color: rgb(174, 129, 255);">/courses/</span><span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);">764</span><span class="hljs-regexp" style="box-sizing: border-box; color: rgb(174, 129, 255);">/svm_model.pkl</span>
</code></pre><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">你也可以通过交叉验证来看一看模型分类的正确率情况。向上面的代码块中添加两行。这个过程可能需要更长的时间，非常不建议在线上环境中执行。</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; padding: 9.5px; margin-top: 0px; margin-bottom: 10px; line-height: 1.42857; word-break: break-all; overflow-wrap: break-word; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; font-variant-ligatures: normal; orphans: 2; widows: 2;"><code class="hljs python" style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: inherit; padding: 0.5em; color: rgb(248, 248, 242); background-color: rgb(35, 36, 31); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; white-space: pre-wrap; word-break: break-all; display: block; overflow-x: auto;"><span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">from</span> sklearn.model_selection <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">import</span> cross_val_score

<span class="hljs-comment" style="box-sizing: border-box; color: rgb(117, 113, 94);"># 输出模型交叉验证准确率</span>
<span class="hljs-built_in" style="box-sizing: border-box; color: rgb(230, 219, 116);">print</span>(cross_val_score(model, x, y))
</code></pre><h3 id="-" style="box-sizing: border-box; font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; line-height: 1.25; color: rgb(36, 41, 46); margin-top: 24px; margin-bottom: 16px; font-size: 1.25em; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">对实验楼评判进行情绪判断</h3><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">有了 Word2vec 模型以及支持向量机情绪分类模型。接下来，我们就可以对实验楼的用户评论进行情绪预测了。</p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">新建一个&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">sentiment_predict.py</code>&nbsp;文件。</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; padding: 9.5px; margin-top: 0px; margin-bottom: 10px; line-height: 1.42857; word-break: break-all; overflow-wrap: break-word; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; font-variant-ligatures: normal; orphans: 2; widows: 2;"><code class="hljs " style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: inherit; padding: 0.5em; color: rgb(248, 248, 242); background-color: rgb(35, 36, 31); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; white-space: pre-wrap; word-break: break-all; display: block; overflow-x: auto;"><span class="hljs-comment" style="box-sizing: border-box; color: rgb(117, 113, 94);"># -*- coding: utf-8 -*-</span>

<span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">from</span> gensim.models.word2vec <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">import</span> Word2Vec
<span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">import</span> numpy <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">as</span> np
<span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">import</span> jieba
<span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">from</span> sklearn.externals <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">import</span> joblib
<span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">import</span> pandas <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">as</span> pd

<span class="hljs-comment" style="box-sizing: border-box; color: rgb(117, 113, 94);"># 读取 Word2Vec 并对新输入进行词向量计算</span>
<span class="hljs-function" style="box-sizing: border-box;"><span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">def</span> <span class="hljs-title" style="box-sizing: border-box; color: rgb(166, 226, 46);">average_vec</span><span class="hljs-params" style="box-sizing: border-box;">(words)</span>:</span>
    <span class="hljs-comment" style="box-sizing: border-box; color: rgb(117, 113, 94);"># 读取 Word2Vec 模型</span>
    w2v = Word2Vec.load(<span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);">'data/w2v_model.pkl'</span>)
    vec = np.zeros(<span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);">300</span>).reshape((<span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);">1</span>, <span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);">300</span>))
    <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">for</span> word <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">in</span> words:
        <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">try</span>:
            vec += w2v[word].reshape((<span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);">1</span>, <span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);">300</span>))
        <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">except</span> KeyError:
            <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">continue</span>
    <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">return</span> vec

<span class="hljs-comment" style="box-sizing: border-box; color: rgb(117, 113, 94);"># 对实验楼评论进行情感判断</span>
<span class="hljs-function" style="box-sizing: border-box;"><span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">def</span> <span class="hljs-title" style="box-sizing: border-box; color: rgb(166, 226, 46);">svm_predict</span><span class="hljs-params" style="box-sizing: border-box;">()</span>:</span>
    <span class="hljs-comment" style="box-sizing: border-box; color: rgb(117, 113, 94);"># 读取实验楼评论</span>
    df = pd.read_csv(<span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);">"comments.csv"</span>, header=<span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);">0</span>)

    comment_sentiment = []
    <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">for</span> string <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">in</span> df[<span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);">'评论内容'</span>]:
        <span class="hljs-comment" style="box-sizing: border-box; color: rgb(117, 113, 94);"># 对评论分词</span>
        words = jieba.lcut(str(string))
        words_vec = average_vec(words)
        <span class="hljs-comment" style="box-sizing: border-box; color: rgb(117, 113, 94);"># 读取支持向量机模型</span>
        model = joblib.load(<span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);">'data/svm_model.pkl'</span>)
        result = model.predict(words_vec)
        comment_sentiment.append(result[<span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);">0</span>])

        <span class="hljs-comment" style="box-sizing: border-box; color: rgb(117, 113, 94);"># 实时返回积极或消极结果</span>
        <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">if</span> int(result[<span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);">0</span>]) == <span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);">1</span>:
            print(string, <span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);">'[积极]'</span>)
        <span class="hljs-keyword" style="box-sizing: border-box; color: rgb(249, 38, 114);">else</span>:
            print(string, <span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);">'[消极]'</span>)

    <span class="hljs-comment" style="box-sizing: border-box; color: rgb(117, 113, 94);">#将情绪结果合并到原数据文件中</span>
    merged = pd.concat([df, pd.Series(comment_sentiment, name=<span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);">'用户情绪'</span>)], axis=<span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);">1</span>)

    <span class="hljs-comment" style="box-sizing: border-box; color: rgb(117, 113, 94);"># 储存文件</span>
    pd.DataFrame.to_csv(merged,<span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);">'comment_sentiment.csv'</span>)
    print(<span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);">'done.'</span>)

<span class="hljs-comment" style="box-sizing: border-box; color: rgb(117, 113, 94);"># 执行</span>
svm_predict()
</code></pre><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">执行&nbsp;<code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 14.4px; padding: 2px 4px; color: rgb(199, 37, 78); background-color: rgb(249, 242, 244); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; word-break: break-all;">sentiment_predict.py</code>，就可以看到实时预测结果了。</p><pre style="box-sizing: border-box; overflow: auto; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; padding: 9.5px; margin-top: 0px; margin-bottom: 10px; line-height: 1.42857; word-break: break-all; overflow-wrap: break-word; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; font-variant-ligatures: normal; orphans: 2; widows: 2;"><code class="hljs bash" style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: inherit; padding: 0.5em; color: rgb(248, 248, 242); background-color: rgb(35, 36, 31); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; white-space: pre-wrap; word-break: break-all; display: block; overflow-x: auto;">$ <span class="hljs-regexp" style="box-sizing: border-box; color: rgb(174, 129, 255);">/home/</span>shiyanlou<span class="hljs-regexp" style="box-sizing: border-box; color: rgb(174, 129, 255);">/anaconda3/</span>bin<span class="hljs-regexp" style="box-sizing: border-box; color: rgb(174, 129, 255);">/python sentiment_predict.py</span>
</code></pre><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">随机截取了一段返回结果，看起来还不错。（红色箭头为人工标记错误）&nbsp;<img src="resources/6B39D8BBE60A65871EF8462CE0A459A3.png" alt="此处输入图片的描述" style="box-sizing: content-box; border: 0px none; vertical-align: middle; background-color: rgb(255, 255, 255); cursor: pointer;" width="861" height="276"></p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">最后，我们可以通过饼状图看一下实验楼用户的情绪分布。总体看来，73% 都为积极评论，正能量满满。^-^</p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);"><img src="resources/4CCCB7E028884A62916D4E9AD1146C95.png" alt="此处输入图片的描述" style="box-sizing: content-box; border: 0px none; vertical-align: middle; background-color: rgb(255, 255, 255); cursor: pointer;" width="659" height="340"></p><h2 id="-" style="box-sizing: border-box; font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; line-height: 1.25; color: rgb(36, 41, 46); margin-top: 24px; margin-bottom: 16px; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(234, 236, 239); font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">实验总结</h2><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">本章节，我们使用机器学习方法对实验楼用户真实评论进行了情感分析。内容涉及比较多，尤其是 Word2vec 处理。鉴于本课程的目的，我们并没有针对 Word2vec 进行太详细的介绍。如果你对自然语言处理感兴趣，Word2vec 一定是需要理解透彻的方法。除了使用机器学习方法，在文本情感分析时。我们往往会用到 LSTM（Long Short Term Memory networks）长短期记忆递归神经网络训练分类模型，在大规模语料数据中，应用效果可能会更优于支持向量机等方法。学有余力时，也可以自行了解学习。</p><p style="box-sizing: border-box; margin: 0px 0px 16px; color: rgb(36, 41, 46); font-family: -apple-system, system-ui, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(249, 249, 249);">除此之外，由于本次实验所用语料库来源于第三方购物网站的评论。所以，其训练的模型在预测实验楼用户情绪方面，可能并没有太好的泛化能力。如果能针对现有数据进行人工标注，对于预测以后的数据，结果应该会更好。</p></div></div>
      <script>document.body.onkeyup = function(e) {
if (e.keyCode === 39) window.location.href = '十三、实验楼课程数据分析.html';
if (e.keyCode === 37) window.location.href = '十五、实验楼用户购买会员行为预测.html';
}</script>
    </body>
    </html>
  